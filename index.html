<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Muslim App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #F2F2F7; margin: 0; padding: 20px; text-align: center; }
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h1 { margin: 0 0 10px; font-size: 24px; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; margin-top: 10px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn-blue { background: #007AFF; color: white; }
        .btn-green { background: #34C759; color: white; }
        .info { color: #8E8E93; font-size: 13px; margin-top: 10px; }
        #coords { font-family: monospace; color: #FF3B30; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="card">
        <h1>üîç –ü–æ–∏—Å–∫ –ì–æ—Ä–æ–¥–∞</h1>
        <p class="info">–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: Qusar)</p>
        <input type="text" id="cityInput" placeholder="Baku, Qusar, Moscow...">
        <button class="btn-blue" onclick="searchCity()">üîé –ù–∞–π—Ç–∏</button>
    </div>

    <div class="card" id="resultCard" style="display:none;">
        <h2 id="cityName">–ì–æ—Ä–æ–¥</h2>
        <div id="coords">Lat: 0, Lon: 0</div>
        <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
        
        <div style="display:flex; justify-content:space-between;">
            <b>–§–∞–¥–∂—Ä:</b> <span id="timeFajr">--:--</span>
        </div>
        <div style="display:flex; justify-content:space-between;">
            <b>–ó—É—Ö—Ä:</b> <span id="timeDhuhr">--:--</span>
        </div>

        <br>
        <button class="btn-green" onclick="saveToBot()">üì° –°–û–•–†–ê–ù–ò–¢–¨ –í –ë–û–¢–ê</button>
        <p class="info">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –±–æ—Ç –∑–∞–ø–æ–º–Ω–∏–ª —ç—Ç–æ –≤—Ä–µ–º—è!</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        let currentLat = 0;
        let currentLon = 0;

        function searchCity() {
            let city = document.getElementById('cityInput').value;
            if(!city) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞!");

            fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=&method=14`)
                .then(res => res.json())
                .then(data => {
                    if(data.code === 200) {
                        // 1. –ó–ê–ü–û–ú–ò–ù–ê–ï–ú –ö–û–û–†–î–ò–ù–ê–¢–´
                        currentLat = data.data.meta.latitude;
                        currentLon = data.data.meta.longitude;

                        // 2. –ü–û–ö–ê–ó–´–í–ê–ï–ú –ù–ê –≠–ö–†–ê–ù–ï (–î–õ–Ø –ü–†–û–í–ï–†–ö–ò)
                        document.getElementById('cityName').innerText = city.toUpperCase();
                        document.getElementById('coords').innerText = `Lat: ${currentLat}, Lon: ${currentLon}`;
                        document.getElementById('timeFajr').innerText = data.data.timings.Fajr;
                        document.getElementById('timeDhuhr').innerText = data.data.timings.Dhuhr;
                        
                        document.getElementById('resultCard').style.display = 'block';
                    } else {
                        alert("–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü–æ–ø—Ä–æ–±—É–π –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏ (Qusar, Gusar).");
                    }
                })
                .catch(e => alert("–û—à–∏–±–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞: " + e));
        }

        function saveToBot() {
            if(currentLat === 0) return alert("–°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏ –≥–æ—Ä–æ–¥!");
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –†–ï–ê–õ–¨–ù–´–ï –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            tg.sendData(JSON.stringify({
                action: 'sync_location',
                lat: currentLat,
                lon: currentLon,
                offset: new Date().getTimezoneOffset()
            }));
        }
    </script>
</body>
</html>

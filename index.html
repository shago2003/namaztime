<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>Muslim App</title>
    <style>/* можно свои стили или минимальные */</style>
</head>
<body>
    <div id="app">
        <input type="text" id="city" placeholder="Город">
        <button onclick="searchCity()">Найти</button>
        <button onclick="getLocation()">GPS</button>
        <div id="result"></div>
    </div>
    <script>
        const tg = Telegram.WebApp; tg.expand();
        let lat, lon, tz;

        async function searchCity() {
            let city = document.getElementById('city').value;
            let res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}&limit=1`);
            let data = await res.json();
            if (data.length) {
                lat = data[0].lat; lon = data[0].lon;
                fetchTimes(lat, lon, data[0].display_name.split(',')[0]);
            }
        }

        function getLocation() {
            navigator.geolocation.getCurrentPosition(pos => {
                lat = pos.coords.latitude; lon = pos.coords.longitude;
                fetchTimes(lat, lon, 'Ваше местоположение');
            });
        }

        async function fetchTimes(lat, lon, name) {
            let date = new Date();
            let url = `https://api.aladhan.com/v1/timings/${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}?latitude=${lat}&longitude=${lon}&method=3&school=0`;
            let res = await fetch(url);
            let data = await res.json();
            tz = data.data.meta.timezone;
            document.getElementById('result').innerHTML = `
                <h3>${name} (${tz})</h3>
                Фаджр: ${data.data.timings.Fajr}<br>
                Зухр: ${data.data.timings.Dhuhr}<br>
                Аср: ${data.data.timings.Asr}<br>
                Магриб: ${data.data.timings.Maghrib}<br>
                Иша: ${data.data.timings.Isha}<br>
                <button onclick="saveToBot()">Сохранить в бота</button>
            `;
        }

        function saveToBot() {
            tg.sendData(JSON.stringify({
                action: 'sync_location',
                lat: parseFloat(lat),
                lon: parseFloat(lon),
                offset: new Date().getTimezoneOffset(),
                timezone: tz,
                school: 0
            }));
            tg.close();
        }
    </script>
</body>
</html>
